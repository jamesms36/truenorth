<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compass Heading</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #heading {
            font-size: 48px;
            font-weight: bold;
        }
        #error {
            color: red;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="heading">--</div>
    <div id="error"></div>
    <div id="debug"></div>

    <script>
        const headingElement = document.getElementById('heading');
        const errorElement = document.getElementById('error');
        const debugElement = document.getElementById('debug');

        function handleOrientation(event) {
            debugElement.innerHTML = `Raw data: alpha=${event.alpha}, beta=${event.beta}, gamma=${event.gamma}, webkitCompassHeading=${event.webkitCompassHeading}`;
            
            if (event.webkitCompassHeading) {
                // For iOS devices
                updateHeading(event.webkitCompassHeading);
            } else if (event.alpha !== null) {
                // For Android devices
                updateHeading(360 - event.alpha);
            } else {
                debugElement.innerHTML += '<br>No valid orientation data received.';
            }
        }

        function updateHeading(heading) {
            headingElement.textContent = Math.round(heading) + '°';
            debugElement.innerHTML += `<br>Calculated heading: ${heading}°`;
        }

        if ('DeviceOrientationEvent' in window) {
            if (DeviceOrientationEvent.requestPermission) {
                // iOS 13+ requires permission
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                        } else {
                            errorElement.textContent = 'Permission to access device orientation was denied.';
                        }
                    })
                    .catch(console.error);
            } else {
                // Non iOS 13+ devices
                window.addEventListener('deviceorientation', handleOrientation);
            }
        } else {
            errorElement.textContent = 'Device orientation is not supported by your device or browser.';
        }
    </script>
</body>
</html>